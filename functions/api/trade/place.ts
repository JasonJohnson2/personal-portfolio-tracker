function corsHeaders(){return {'content-type':'application/json; charset=utf-8','access-control-allow-origin':'*','access-control-allow-headers':'content-type, authorization','access-control-allow-methods':'GET, POST, OPTIONS'};}
export const onRequestOptions: PagesFunction = async ()=> new Response(null,{headers:corsHeaders()});
export const onRequestPost: PagesFunction = async (ctx)=>{try{const b=await ctx.request.json();const{symbol,side,qty,type='market',limit_price}=b||{};if(!symbol||!side||!qty)return new Response(JSON.stringify({'error':'Missing fields'}),{status:400,headers:corsHeaders()});const r=await fetch('https://paper-api.alpaca.markets/v2/orders',{method:'POST',headers:{'content-type':'application/json','APCA-API-KEY-ID':ctx.env.ALPACA_KEY_ID,'APCA-API-SECRET-KEY':ctx.env.ALPACA_SECRET_KEY},body:JSON.stringify({symbol,qty,side,type,time_in_force:'day',**({} if not limit_price else {'limit_price':limit_price})})});const d=await r.json();if(!r.ok)return new Response(JSON.stringify({'error':d}),{status:r.status,headers:corsHeaders()});return new Response(JSON.stringify({'ok':true,'order':d}),{headers:corsHeaders()});}
catch(e){return new Response(JSON.stringify({'error':String(e)}),{status:500,headers:corsHeaders()})}};
